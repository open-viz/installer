apiVersion: appcatalog.appscode.com/v1alpha1
kind: AppBinding
metadata:
  name: {{ include "grafana-configurator.fullname" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "grafana-configurator.labels" . | nindent 4 }}
spec:
  type: Grafana
  clientConfig:
  {{- if .Values.grafana.url }}
    url: {{ .Values.grafana.url }}
  {{- else }}
    service:
      scheme: {{ required "A valid .Values.grafana.service.scheme entry required!" .Values.grafana.service.scheme }}
      name: {{ required "A valid .Values.grafana.service.name entry required!" .Values.grafana.service.name }}
      port: {{ required "A valid .Values.grafana.service.port entry required!" .Values.grafana.service.port }}
    {{- with .Values.grafana.service.path }}
      path: {{ . }}
    {{- end }}
    {{- with .Values.grafana.service.query }}
      query: {{ . }}
    {{- end }}
  {{- end }}
  secret:
    name: {{ include "grafana-configurator.fullname" . }}-auth
{{- if .Values.grafana.tls.insecureSkipTLSVerify }}
  insecureSkipTLSVerify: true
{{- end }}
{{- with .Values.grafana.tls.caBundle }}
  caBundle: {{ . | b64enc }}
{{- end }}
{{- if or .Values.dashboard.datasource .Values.dashboard.folderID }}
  parameters:
    apiVersion: openviz.dev/v1alpha1
    kind: DatasourceConfiguration
  {{- with .Values.dashboard.datasource }}
    datasource: {{ . }}
  {{- end }}
  {{- with .Values.dashboard.folderID }}
    folderID: {{ . }}
  {{- end }}
{{- end }}
